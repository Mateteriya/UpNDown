# Предстоящие изменения (что поменять позже)

Список пунктов, которые нужно будет доработать или добавить в следующих итерациях. Отмечай по мере выполнения.

---

## Статистика и история

- [ ] **Экран статистики/истории и незавершённые онлайн-партии**  
  При отказе пользователя вернуться в партию (после замены на ИИ) запись сохраняется через `saveUnfinishedOnlineGame(roomId, code)` в localStorage. Список доступен через `getUnfinishedOnlineGames()` (см. `src/game/persistence.ts`). Позже нужно завязать на эти данные экран статистики или «Мои партии» / «История» — показывать незавершённые онлайн-партии отдельным блоком (код комнаты, дата выхода), без учёта в личном рейтинге.

---

## Онлайн и рейтинг: RLS → RPC

- [ ] **MVP‑политики RLS**  
  На старте оставить простые политики: аутентифицированным пользователям разрешены INSERT/SELECT в `matches` и `match_players` (для быстрой обкатки).
- [ ] **Позже ужесточить**  
  Запретить прямые INSERT в `matches`/`match_players` и писать только через RPC `finish_game` (SECURITY DEFINER).  
  Клиент шлёт JSON по игрокам; сервер фиксирует матч, участников, пересчитывает места, проставляет флаги `interrupted`/`is_rated`.

---

## Связанные документы

- [PLAN-DALEE.md](./PLAN-DALEE.md) — общий план шагов.
- [ONLINE-УПРОЩЕНИЯ-И-ПЕРЕЕЗД.md](./ONLINE-УПРОЩЕНИЯ-И-ПЕРЕЕЗД.md) — что упростили во временном онлайне и что менять при переезде.
