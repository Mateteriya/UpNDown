# План дальше: шесть шагов (Up&Down)

Единый ориентир для разработки после завершения фундамента «профиль + рейтинг + авторизация». Подробности по каждому шагу — в указанных документах.

---

## 1. Довести «фундамент» до конца — **выполнено**

- **Синхронизация имени при загрузке партии** — в коде: при восстановлении из storage в `GameTable` подставляется текущий `playerDisplayName` (профиль).
- **Рейтинг к профилю** — рейтинг привязан к `profileId`; миграция со старого ключа «на устройство» есть.
- **Чеклист перед авторизацией/онлайном** — закрыт (имя, profileId, синк профиля с Supabase, email в UI).

**Документ:** [NEXT-STEPS-AUTH-RATINGS-ONLINE.md](./NEXT-STEPS-AUTH-RATINGS-ONLINE.md).

**Опционально (по желанию):**
- Небольшая доработка экрана «Ваш рейтинг»: история последних N партий или разбивка по режимам (когда появятся несколько режимов).
- Правила для AI/чатов: [AGENTS.md](../AGENTS.md) в корне и `.cursor/rules/project-conventions.mdc` — один источник правды, профиль, не ломать мобильную при правках ПК.

---

## 2. Мобильная проверка и полировка

- Пройти чеклист из [ЧТО-ДЕЛАТЬ-ДАЛЬШЕ-мобильная-позиционирование.md](./ЧТО-ДЕЛАТЬ-ДАЛЬШЕ-мобильная-позиционирование.md):
  - Проверить на реальном устройстве или в DevTools (375×667 и уже): рука не вылезает за край, карты на столе в сетке 2×2, козырь на колоде на месте.
  - Комментарии в `GameTable.tsx` / `CardView.tsx` и стили в `index.css` (viewport-mobile, `.game-table-root:not(.viewport-mobile)`) — в актуальном состоянии.
- Проверить вход через Google (и при необходимости GitHub) с мобильного: редирект на `auth-callback.html`, возврат в приложение без чёрного экрана.
- В Supabase: Redirect URLs включают продакшен и `https://<домен>/auth-callback.html`.
- При необходимости дописать в тот же док «Заметки по позициям» и «Планы из того чата».

---

## 3. Онлайн (Альфа)

- Реализовать лобби и столы через **отдельный игровой сервер** (Node.js + WebSocket) на машине друга. Комнаты на 3–4 игрока, проверка правил на сервере.
- **LobbyScreen:** заменить заглушку на «Создать комнату» / «Присоединиться по коду», переход в игру с общим state по WebSocket.
- **Подробная инструкция** (кто что делает: ты, друг, я): [ONLINE-SERVER-INSTRUCTIONS.md](./ONLINE-SERVER-INSTRUCTIONS.md).
- Архитектура аккаунтов/рейтингов: [ARCHITECTURE-ACCOUNTS-RATINGS.md](./ARCHITECTURE-ACCOUNTS-RATINGS.md).

---

## 4. Уровни ИИ (Альфа по TZ)

- Сейчас один уровень сложности. Добавить 2–3 уровня (например «Новичок», «Любитель», «Эксперт») в `src/game/ai.ts`.
- Выбор уровня в меню перед стартом офлайн-игры.

---

## 5. Архив результатов и статистика

- При `game-complete` писать срез партии (итоги + раздачи) в локальное хранилище (отдельный ключ или IndexedDB) с привязкой к `profileId`.
- Экран «Мои партии» или расширить «Ваш рейтинг» историей последних партий — без бэкенда, только локально.
- Детали: [ARCHITECTURE-ACCOUNTS-RATINGS.md](./ARCHITECTURE-ACCOUNTS-RATINGS.md) (раздел «Хранение результатов», «Следующий шаг без бэкенда»).

---

## 6. Турниры / Обучение (по TZ — позже)

- Кнопки «Турниры (скоро)» и «Обучение (скоро)» пока отключены.
- Логично включать после стабильного онлайна и рейтинга.

---

## Сводка

| Шаг | Описание | Статус |
|-----|----------|--------|
| 1 | Фундамент (имя, profileId, рейтинг, авторизация) | ✅ Выполнено |
| 2 | Мобильная проверка и полировка | Чеклист в доке |
| 3 | Онлайн: лобби, столы, общий state | Заглушка в LobbyScreen |
| 4 | Уровни ИИ (Новичок / Любитель / Эксперт) | Один уровень в ai.ts |
| 5 | Архив результатов, история в «Ваш рейтинг» | Не начато |
| 6 | Турниры, Обучение | Отложено |
