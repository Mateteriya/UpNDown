# Локальная разработка с авторизацией и онлайн-игрой

Чтобы тестировать изменения локально (без пуша на Vercel после каждого правки): запускайте приложение на своём компьютере и один раз настройте Supabase так, чтобы OAuth возвращался на localhost.

---

## 1. Переменные окружения

В корне проекта уже есть `.env.local` (или создайте из `.env.example`) с ключами Supabase:

```
VITE_SUPABASE_URL=https://xxxxx.supabase.co
VITE_SUPABASE_ANON_KEY=eyJ...
```

Те же ключи используются и локально, и на проде — один проект Supabase. Локально вы подключаетесь к тому же бэкенду (авторизация, комнаты, Realtime).

---

## 2. Разрешить редирект на localhost в Supabase

После входа через Google (или GitHub) Supabase перенаправляет браузер на ваш **Redirect URL**. Если в настройках Supabase нет локального адреса, редирект уйдёт на прод (Vercel).

1. Зайдите в [Supabase Dashboard](https://supabase.com/dashboard) → ваш проект.
2. **Authentication** → **URL Configuration**.
3. В блоке **Redirect URLs** добавьте (по одному на строку):
   - `http://localhost:5173/auth-callback.html`
   - `http://127.0.0.1:5173/auth-callback.html`
4. Если будете заходить с телефона по Wi‑Fi на свой ПК, добавьте:
   - `http://192.168.x.x:5173/auth-callback.html`  
   (подставьте IP вашего компьютера в локальной сети; порт 5173 — стандартный для Vite).

Сохраните. После этого OAuth будет возвращать пользователя на указанный адрес.

**Site URL** можно не менять: для редиректа важны именно **Redirect URLs**.

---

## 3. Запуск локально

```bash
npm run dev
```

Откройте в браузере: **http://localhost:5173** (или тот адрес, который выведет Vite).

- Вход через Google/GitHub вернёт на `http://localhost:5173/auth-callback.html`, затем приложение откроется снова на localhost.
- Онлайн-игра (комнаты, Realtime) работает так же, как на проде — через тот же Supabase.

---

## 4. Порты

По умолчанию Vite использует порт **5173**. Если у вас другой порт (например 5197), добавьте в Supabase Redirect URLs соответствующий URL:

- `http://localhost:ВАШ_ПОРТ/auth-callback.html`
- `http://127.0.0.1:ВАШ_ПОРТ/auth-callback.html`

Узнать порт можно в выводе `npm run dev` (строка вида `Local: http://localhost:5173/`).

---

## 5. Тест с телефона без деплоя на Vercel

Чтобы проверить присоединение по коду с телефона, не пушая на прод:

1. Запустите dev-сервер так, чтобы он был доступен в сети:  
   `npm run dev:host`
2. Узнайте IP вашего ПК в Wi‑Fi (Windows: `ipconfig`, ищите IPv4, например `192.168.1.5`).
3. В `.env.local` добавьте (подставьте свой IP и порт):  
   `VITE_INVITE_URL=http://192.168.1.5:5173`
4. Перезапустите `npm run dev`.
5. В Supabase → Redirect URLs добавьте `http://192.168.x.x:5173/auth-callback.html` (как в п.2 документа).
6. На ПК откройте http://localhost:5173, создайте комнату. Кнопки «Скопировать код» / «Поделиться кодом» будут подставлять в ссылку ваш `VITE_INVITE_URL`.
7. На телефоне в той же Wi‑Fi откройте эту ссылку (или введите код в «Присоединиться» на том же URL).

Так можно тестировать все новые изменения локально, без пуша на Vercel.

---

## 6. Краткий чеклист

- [ ] В проекте есть `.env.local` с `VITE_SUPABASE_URL` и `VITE_SUPABASE_ANON_KEY`.
- [ ] Для теста с телефона без деплоя: `npm run dev -- --host`, в `.env.local` задан `VITE_INVITE_URL=http://ВАШ_IP:5173`, в Supabase добавлен Redirect URL с этим хостом.
- [ ] В Supabase → Authentication → URL Configuration в **Redirect URLs** добавлены `http://localhost:5173/auth-callback.html` и `http://127.0.0.1:5173/auth-callback.html`.
- [ ] Запуск: `npm run dev`, открыть http://localhost:5173.
- [ ] Проверить вход через Google и создание/вход в онлайн-комнату.

После этого можно разрабатывать и тестировать авторизацию и онлайновую игру локально и пушить на Vercel только когда всё проверено.
